---
title: "M3 Competition Time Series"
output: html_notebook
---
Time series data from the third Makridakis forecasting competition (M3), held in 2000.

Source: https://onlinelibrary.wiley.com/doi/10.1002/for.3980010202

##Load series


``` r
library(dalts)
library(daltoolbox)
library(harbinger)
library(tspredit)

## Load series ----------------------
data(m3)
head(m3$monthly, 5)
```

```
## $M1
##   [1] 2640 2640 2160 4200 3360 2400 3600 1920 4200 4560  480 3720 5640 2880 1800 3120 2400 2520 9000 2640 3120 2880 8760 5160
##  [25] 2160 8280 4920 3120 6600 4080 5880 1680 6720 2040 6480 1920 3600 2040 2760 3840  960 2280 1320 2160 4800 3000 3120 5880
##  [49] 2640 2400 2280  480 5040 1920  840 2520 1560 1440  240 1800 4680 1800 1680 3720 2160  480 2040 1440   NA   NA   NA   NA
##  [73]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
##  [97]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
## [121]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
## 
## $M160
##   [1] 2800 1200 2500 2800 3050 3050 2500 3950 3750 4650 3850 2250 2750 3950 3050 3750 3600 4900 5350 4450 4250 4050 5100 3900
##  [25] 5300 4700 4250 5900 5650 5350 5350 5000 4750 6900 5350 7550 5600 4800 6600 5650 4600 6300 5700 6500 7600 4750 4900 7500
##  [49] 6000 5800 7800 6750 5950 8400 5150 9000 8050 6250 8000 6100 6300 5700 5950 5900 7700 8250 6650 7500 5800   NA   NA   NA
##  [73]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
##  [97]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
## [121]   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
## 
## $M318
##   [1] 3320 3240 3120 3660 4540 3420 3300 4160 4480 3980 4020 3860 3180 3120 4260 3220 3640 4820 3560 4380 4560 4100 3860 3500
##  [25] 3780 3460 2980 3040 3180 5000 3720 3760 4260 4540 4520 3720 3280 3120 3300 3200 3460 3440 4000 4100 4180 4620 4700 3720
##  [49] 3380 3160 3700 3380 3220 4800 3660 3600 4620 4220 4020 3560 3580 3240 3160 3340 3420 3580 3880 4800 3860 4560 4160 3200
##  [73] 3400 3340 3000 3080 3180 3680 4400 3640 4620 3880 3760 3320 3160 3000 3140 3340 3140 4260 3360 3740 4460 4500 3740 3680
##  [97] 3220 3120 3100 3100 3040 3340 3560 3840 4240 4260 4560 3520 3220 3480 3020 3240 2980 3260 3360 3160 4800 5000 3760 3260
## [121] 3060 3040 2840 3180 2960 3700   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
## 
## $M477
##   [1] 5379.2 5338.0 5977.0 5585.6 5594.2 5590.6 5458.8 4778.8 3979.2 3950.0 4659.4 5552.0 5847.0 5590.0 6060.4 5997.8 6238.8
##  [18] 6138.4 5622.6 5165.6 4342.4 4149.4 4935.6 6338.2 5947.4 5580.0 6087.0 5994.0 6362.8 5754.6 5499.0 5027.4 4182.2 4177.4
##  [35] 4451.8 5166.8 5508.6 5180.4 4928.0 4880.6 5284.2 4767.8 4258.6 3996.2 3753.4 4009.6 4590.8 5071.8 4275.4 4644.4 5693.0
##  [52] 5504.6 5441.0 5244.6 4814.4 4237.8 4222.8 4267.0 4630.6 5193.0 5082.4 4245.2 4649.6 4405.0 4840.4 4172.6 4039.0 3689.2
##  [69] 3636.0 3591.0 3371.4 4217.4 4406.2 3821.0 3902.8 3820.8 4247.6 3766.6 3380.8 3289.4 3254.0 3022.4 3693.2 3982.6 4186.0
##  [86] 3724.0 4528.4 4815.4 5609.8 5176.2 4534.0 4037.4 3783.8 4015.2 4237.2 4364.6 4682.4 4830.2 5608.4 5077.4 5400.2 5524.2
## [103] 4731.6 4209.6 3394.2 3721.0 3998.6 4790.4 5135.2 4383.0 5164.0 5137.4 5690.8 5166.0 4850.0 4349.4 3685.6 3507.6 3659.8
## [120] 4374.6 4300.4 3593.2 4313.2 3890.8 4457.0 4539.6 3942.2 3612.4 3367.6 3275.0 3858.8 4761.6 4894.8 3948.6 4716.6 5034.2
## [137] 5864.6 5321.2 4715.0 3937.0 3417.8     NA     NA     NA
## 
## $M635
##   [1] 1920 2000 2120 2020 1880 1980 2280 2900 3060 3280 3060 2900 3140 3700 3740 3880 3460 3300 3000 3320 3360 3300 3060 2800
##  [25] 3220 2800 2640 1700 1860 2420 2340 2060 2220 2440 2220 2120 2360 2320 2300 2060 1980 2340 2820 2980 2820 2640 2580 2480
##  [49] 2500 2160 2540 2320 2300 2480 2740 2960 3060 3000 3060 3320 3400 3720 3640 3540 3760 3940 3700 3560 3600 3460 3000 4160
##  [73] 3660 3580 4060 3540 3680 4040 3800 4300 4740 4200 3900 4200 3780 3940 3700 2800 3400 3440 3500 3940 4520 4440 4260 4300
##  [97] 4680 4580 4780 4760 4980 5480 5600 6160 5900 5660 4900 4500 5100 6640 6340 4520 4580 5140 5480 5260 6320 7000 3220 3340
## [121] 3400 3180 3000 3620 3920 3920 3420 3540 4440 4580 4020 4120 4240   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA   NA
```


``` r
serie <- m3$monthly$M1111
serie
```

```
##   [1] 4040 4125 4175 4075 4215 4315 3965 4040 4230 4290 4245 3890 3885 4060 4060 4215 4315 4545 4250 4345 4565 4585 4565 4245
##  [25] 4230 4460 4555 4565 4775 5000 4670 4725 4965 4915 4890 4520 4550 4760 4860 4855 5070 5310 4780 4985 5270 5255 5330 4980
##  [49] 5020 5335 5290 5420 5585 5745 5210 5515 5740 5695 5815 5390 5460 5650 5850 5810 6050 6240 5750 5920 6165 6340 6370 6055
##  [73] 6030 6310 6350 6375 6490 6650 6095 6270 6570 6680 6660 6270 6210 6410 6405 6640 6625 6835 6145 6440 6790 6715 6885 6570
##  [97] 6445 6590 6695 6905 7145 7390 6505 6740 7355 7450 7590 7085 6960 7310 7545 7420 7650 7870 6975 7250 7730 7700 7840 7335
## [121] 7185 7585 7465 7640 7675 7825 6900 7240 7550 7545 7620 7085 7095 7515 7630 7615 7825 8120 7055 7725 8265 8285 8220 7580
```




``` r
values <- as.numeric(serie)
num_points <- length(values)
years <- 1:num_points
years
```

```
##   [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30
##  [31]  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60
##  [61]  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
##  [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120
## [121] 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
```

``` r
plot(years, values, type = "l", main = "M3 Series", ylab = "Value", xlab = "V")
```

![plot of chunk unnamed-chunk-3](fig/m3/unnamed-chunk-3-1.png)

``` r
# Create object ts_data with horizon = 1
ts <- ts_data(values, sw = 1)

# Separate Training and Test samples
samp <- ts_sample(ts, test_size = 5)

#  Input/output projection
io_train <- ts_projection(samp$train)
io_test <- ts_projection(samp$test)
```


``` r
# Create ARIMA and train
model <- ts_arima()
model <- fit(model, x = io_train$input, y = io_train$output)
```


``` r
# Predicting next 5 years
prediction <- predict(model, x = io_test$input[1,], steps_ahead = 5)

# Converting to vector
pred <- as.vector(prediction)
real <- as.vector(io_test$output)

# Evaluate
ev_test <- evaluate(model, real, pred)
ev_test
```

```
## $values
## [1] 7725 8265 8285 8220 7580
## 
## $prediction
## [1] 7144.005 7692.897 7712.865 7734.475 7757.109
## 
## $smape
## [1] 0.06106715
## 
## $mse
## [1] 251859.5
## 
## $R2
## [1] -1.793783
## 
## $metrics
##        mse      smape        R2
## 1 251859.5 0.06106715 -1.793783
```

